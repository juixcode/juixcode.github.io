<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Cards</title>

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
        crossorigin="anonymous"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body class="min-h-screen pb-24 selection:bg-indigo-500/30">

    <!-- Header -->
    <header
        class="sticky top-0 z-40 bg-[#0f172a]/90 backdrop-blur-md border-b border-slate-800 shadow-2xl shadow-black/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div id="nav-action" class="transition-all">
                        <!-- Icon injected by JS -->
                    </div>
                    <div>
                        <h1 id="header-title" class="text-xl font-bold text-white tracking-tight">Flash Révisions</h1>
                        <p id="header-subtitle" class="text-slate-400 text-xs font-medium">Chargement...</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- App Container -->
    <main id="main-content" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-[60vh]">
        <!-- Content injected by JS -->
    </main>

    <!-- FAB Container -->
    <div id="fab-container" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-[30] pointer-events-auto">
        <!-- Button injected by JS -->
    </div>

    <!-- Modals -->
    <div id="modal-overlay" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>

        <div
            class="relative w-full max-w-lg bg-slate-900 rounded-2xl shadow-2xl border border-slate-700 flex flex-col max-h-[90vh] overflow-hidden animate-fade-in">
            <!-- Close Button -->
            <button onclick="closeModal()"
                class="absolute top-4 right-4 text-slate-400 hover:text-white z-10 p-1 rounded-full hover:bg-slate-800">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>

            <!-- DECK FORM -->
            <div id="modal-deck" class="hidden">
                <div class="p-6 border-b border-slate-800">
                    <h2 class="text-xl font-bold text-white">Nouveau Bloc de Fiches</h2>
                </div>
                <form onsubmit="handleCreateDeck(event)" class="p-6 space-y-6">
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-slate-300">Nom du bloc</label>
                        <input type="text" id="deck-title" required placeholder="Ex: Histoire - Dates Clés"
                            class="w-full bg-slate-950 border border-slate-700 rounded-xl p-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none">
                    </div>
                    <div class="space-y-3">
                        <label class="block text-sm font-medium text-slate-300">Style (Dégradé)</label>
                        <div id="gradient-selector" class="flex gap-3 flex-wrap">
                            <!-- Injected -->
                        </div>
                    </div>
                    <button type="submit"
                        class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl mt-4">Valider</button>
                </form>
            </div>

            <!-- CARD FORM -->
            <div id="modal-card" class="hidden">
                <div class="p-6 border-b border-slate-800">
                    <h2 class="text-xl font-bold text-white">Nouvelle Carte</h2>
                </div>
                <form onsubmit="handleCreateCard(event)" class="p-6 overflow-y-auto max-h-[70vh] space-y-5">
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-slate-300">Question</label>
                        <textarea id="card-question" required
                            class="w-full h-20 bg-slate-950 border border-slate-700 rounded-xl p-3 text-white focus:ring-2 focus:ring-indigo-500 outline-none resize-none"></textarea>
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-slate-300">Réponse</label>
                        <textarea id="card-answer" required
                            class="w-full h-20 bg-slate-950 border border-slate-700 rounded-xl p-3 text-white focus:ring-2 focus:ring-emerald-500 outline-none resize-none"></textarea>
                    </div>
                    <div class="space-y-2">
                        <label class="text-sm font-medium text-slate-300">Catégorie</label>
                        <div class="flex gap-2 mb-2">
                            <button type="button" id="btn-existing-theme" onclick="toggleThemeMode(false)"
                                class="flex-1 py-1.5 text-sm rounded-lg bg-indigo-600 text-white">Existante</button>
                            <button type="button" id="btn-new-theme" onclick="toggleThemeMode(true)"
                                class="flex-1 py-1.5 text-sm rounded-lg bg-slate-800 text-slate-400">Nouvelle</button>
                        </div>
                        <div id="container-theme-select">
                            <select id="card-theme-select"
                                class="w-full bg-slate-950 border border-slate-700 rounded-xl p-3 text-white outline-none focus:ring-2 focus:ring-indigo-500"></select>
                        </div>
                        <input id="input-new-theme" type="text" placeholder="Nom de la catégorie"
                            class="hidden w-full bg-slate-950 border border-slate-700 rounded-xl p-3 text-white outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <button type="submit"
                        class="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl">Valider</button>
                </form>
            </div>

            <!-- IMPORT/EXPORT MODAL -->
            <div id="modal-import-export" class="hidden">
                <div class="p-6 border-b border-slate-800">
                    <h2 id="modal-ie-title" class="text-xl font-bold text-white">Importer / Exporter</h2>
                </div>
                <div class="p-6 space-y-4">
                    <p id="modal-ie-desc" class="text-sm text-slate-400">Copiez/Collez ou Déposez un fichier JSON.</p>

                    <!-- Drop Zone (Import Only) -->
                    <div id="import-drop-zone"
                        class="w-full border-2 border-dashed border-slate-700 rounded-xl p-6 flex flex-col items-center justify-center text-slate-500 transition-all hover:border-indigo-500 hover:bg-slate-900/50 cursor-pointer"
                        onclick="document.getElementById('import-file-input').click()">
                        <input type="file" id="import-file-input" class="hidden" accept=".json,.txt"
                            onchange="handleFileSelect(event)">
                        <i data-lucide="upload-cloud" class="w-8 h-8 mb-2 text-slate-400"></i>
                        <span class="text-xs font-medium">Cliquez ou déposez un fichier ici</span>
                    </div>

                    <div class="relative">
                        <textarea id="ie-content"
                            class="w-full h-48 bg-slate-950 border border-slate-700 rounded-xl p-3 text-xs font-mono text-slate-300 focus:ring-2 focus:ring-indigo-500 outline-none resize-none"
                            placeholder='[{"question":"Question1 ?","answer":"Answer1 !","theme":"Général"},{"question":"Question2 ?","answer":"Answer2 !","theme":"Général"}, ...]'></textarea>

                        <!-- Copy Button (Export Only) -->
                        <button id="btn-copy-clipboard" onclick="copyToClipboard()"
                            class="absolute top-2 right-2 p-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg border border-slate-600 transition hidden"
                            title="Copier">
                            <i data-lucide="copy" class="w-4 h-4"></i>
                        </button>

                        <!-- Paste Button (Import Only) -->
                        <button id="btn-paste-clipboard" onclick="pasteFromClipboard()"
                            class="absolute top-2 right-2 p-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg border border-slate-600 transition hidden"
                            title="Coller">
                            <i data-lucide="clipboard-paste" class="w-4 h-4"></i>
                        </button>
                    </div>

                    <div
                        class="bg-slate-900/50 p-3 rounded-lg border border-slate-800 text-xs text-slate-500 font-mono">
                        Supporte: .json, .txt (Format JSON)
                    </div>

                    <div class="flex gap-3 pt-2">
                        <button onclick="closeModal()"
                            class="flex-none px-6 py-3 bg-slate-800 hover:bg-slate-700 text-white font-bold rounded-xl transition">Fermer</button>

                        <!-- Export Actions -->
                        <button id="btn-download-json" onclick="downloadExport('json')"
                            class="flex-1 py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl transition hidden flex items-center justify-center gap-2">
                            <i data-lucide="file-json" class="w-4 h-4"></i> .JSON
                        </button>
                        <button id="btn-download-txt" onclick="downloadExport('txt')"
                            class="flex-1 py-3 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-xl transition hidden flex items-center justify-center gap-2">
                            <i data-lucide="file-text" class="w-4 h-4"></i> .TXT
                        </button>

                        <!-- Import Action -->
                        <button id="btn-perform-import" onclick="handleImportAction()"
                            class="flex-1 py-3 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl transition hidden">Importer</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Logic -->
    <script src="script.js"></script>
</body>

</html>